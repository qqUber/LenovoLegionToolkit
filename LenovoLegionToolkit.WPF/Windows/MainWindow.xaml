<local:BaseWindow
    x:Class="LenovoLegionToolkit.WPF.Windows.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:custom="clr-namespace:LenovoLegionToolkit.WPF.Controls.Custom"
    xmlns:local="clr-namespace:LenovoLegionToolkit.WPF.Windows"
    xmlns:pages="clr-namespace:LenovoLegionToolkit.WPF.Pages"
    xmlns:resources="clr-namespace:LenovoLegionToolkit.WPF.Resources"
    xmlns:utils="clr-namespace:LenovoLegionToolkit.WPF.Utils"
    xmlns:compat="clr-namespace:LenovoLegionToolkit.WPF.Compat"
    xmlns:wpfui="http://schemas.lepo.co/wpfui/2022/xaml"
    Title="{x:Static resources:Resource.AppName}"
    Width="1150"
    Height="750"
    MinWidth="650"
    MinHeight="600"
    FlowDirection="{x:Static utils:LocalizationHelper.Direction}">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Custom Background Layer -->
        <Rectangle x:Name="_backgroundGradient" Grid.RowSpan="6" Visibility="Collapsed" />
        <Image x:Name="_backgroundImage" Grid.RowSpan="6" Stretch="UniformToFill" Visibility="Collapsed" />
        <Rectangle x:Name="_backgroundTint" Grid.RowSpan="6" Visibility="Collapsed" />

        <!-- Custom Title Bar -->
        <Grid
            x:Name="_titleBarGrid"
            Grid.Row="0"
            Height="32"
            Panel.ZIndex="999"
            Background="Transparent"
            MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
            
            <!-- App Icon + Title (Left) -->
            <StackPanel
                Margin="12,0,0,0"
                HorizontalAlignment="Left"
                VerticalAlignment="Center"
                Orientation="Horizontal"
                IsHitTestVisible="False">
                <Image 
                    Source="pack://application:,,,/Assets/brand.ico" 
                    Width="16" 
                    Height="16"
                    Margin="0,0,8,0"
                    RenderOptions.BitmapScalingMode="HighQuality" />
                <TextBlock
                    Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                    FontSize="12"
                    FontWeight="SemiBold"
                    Text="{x:Static resources:Resource.AppName}" />
            </StackPanel>

            <!-- Right side: Device Info + Caption Buttons -->
            <StackPanel
                HorizontalAlignment="Right"
                VerticalAlignment="Stretch"
                Orientation="Horizontal">
                
                <!-- Device Info Badge -->
                <Border
                    x:Name="_deviceInfoBorder"
                    Margin="0,0,8,0"
                    Padding="10,4"
                    VerticalAlignment="Center"
                    Background="Transparent"
                    CornerRadius="4"
                    Cursor="Hand"
                    Visibility="Collapsed"
                    WindowChrome.IsHitTestVisibleInChrome="True"
                    MouseLeftButtonDown="DeviceInfoIndicator_Click"
                    ToolTip="Click to view device &amp; warranty info">
                    <Border.Style>
                        <Style TargetType="Border">
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#20FFFFFF" />
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Border.Style>
                    <TextBlock
                        x:Name="_deviceInfoIndicator"
                        Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                        FontSize="12"
                        FontWeight="Medium" />
                </Border>

                <!-- Minimize Button -->
                <Button
                    x:Name="_minimizeButton"
                    Width="46"
                    Height="32"
                    Click="MinimizeButton_Click"
                    WindowChrome.IsHitTestVisibleInChrome="True"
                    ToolTip="Minimize">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Background" Value="Transparent" />
                            <Setter Property="BorderThickness" Value="0" />
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="Button">
                                        <Border x:Name="bg" Background="{TemplateBinding Background}">
                                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter TargetName="bg" Property="Background" Value="#20FFFFFF" />
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </Button.Style>
                    <wpfui:SymbolIcon Symbol="Subtract24" Foreground="{DynamicResource TextFillColorPrimaryBrush}" FontSize="10" />
                </Button>

                <!-- Maximize/Restore Button -->
                <Button
                    x:Name="_maximizeButton"
                    Width="46"
                    Height="32"
                    Click="MaximizeButton_Click"
                    WindowChrome.IsHitTestVisibleInChrome="True"
                    ToolTip="Maximize">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Background" Value="Transparent" />
                            <Setter Property="BorderThickness" Value="0" />
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="Button">
                                        <Border x:Name="bg" Background="{TemplateBinding Background}">
                                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter TargetName="bg" Property="Background" Value="#20FFFFFF" />
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </Button.Style>
                    <wpfui:SymbolIcon x:Name="_maximizeIcon" Symbol="Maximize24" Foreground="{DynamicResource TextFillColorPrimaryBrush}" FontSize="10" />
                </Button>

                <!-- Close Button -->
                <Button
                    x:Name="_closeButton"
                    Width="46"
                    Height="32"
                    Click="CloseButton_Click"
                    WindowChrome.IsHitTestVisibleInChrome="True"
                    ToolTip="Close">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Background" Value="Transparent" />
                            <Setter Property="BorderThickness" Value="0" />
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="Button">
                                        <Border x:Name="bg" Background="{TemplateBinding Background}">
                                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter TargetName="bg" Property="Background" Value="#E81123" />
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </Button.Style>
                    <wpfui:SymbolIcon Symbol="Dismiss24" Foreground="{DynamicResource TextFillColorPrimaryBrush}" FontSize="10" />
                </Button>
            </StackPanel>
        </Grid>

        <Grid
            x:Name="_contentGrid"
            Grid.Row="1"
            Margin="12,6,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <compat:NavigationStore
                x:Name="_navigationStore"
                Grid.Column="0"
                Margin="0,0,12,12"
                Frame="{Binding ElementName=_rootFrame}"
                SelectedPageIndex="0">

                <compat:NavigationStore.Items>
                    <custom:NavigationItem
                        Content="{x:Static resources:Resource.MainWindow_NavigationItem_Dashboard}"
                        Symbol="{x:Static wpfui:SymbolRegular.Home24}"
                        PageTag="dashboard"
                        PageType="{x:Type pages:DashboardPage}" />
                    <custom:NavigationItem
                        x:Name="_keyboardItem"
                        Content="{x:Static resources:Resource.MainWindow_NavigationItem_Keyboard}"
                        Symbol="{x:Static wpfui:SymbolRegular.Keyboard24}"
                        PageTag="keyboardBacklight"
                        PageType="{x:Type pages:KeyboardBacklightPage}" />
                    <custom:NavigationItem
                        Content="{x:Static resources:Resource.MainWindow_NavigationItem_Battery}"
                        Symbol="{x:Static wpfui:SymbolRegular.Battery924}"
                        PageTag="battery"
                        PageType="{x:Type pages:BatteryPage}" />
                    <custom:NavigationItem
                        Content="{x:Static resources:Resource.MainWindow_NavigationItem_Actions}"
                        Symbol="{x:Static wpfui:SymbolRegular.Flash24}"
                        PageTag="automation"
                        PageType="{x:Type pages:AutomationPage}" />
                    <custom:NavigationItem
                        Content="{x:Static resources:Resource.MainWindow_NavigationItem_Macro}"
                        Symbol="{x:Static wpfui:SymbolRegular.Play24}"
                        PageTag="macro"
                        PageType="{x:Type pages:MacroPage}" />
                    <custom:NavigationItem
                        Content="{x:Static resources:Resource.MainWindow_NavigationItem_Packages}"
                        Symbol="{x:Static wpfui:SymbolRegular.ArrowCircleDown24}"
                        PageTag="packages"
                        PageType="{x:Type pages:PackagesPage}" />
                </compat:NavigationStore.Items>

                <compat:NavigationStore.Footer>
                    <custom:NavigationItem
                        Content="{x:Static resources:Resource.MainWindow_NavigationItem_Settings}"
                        Symbol="{x:Static wpfui:SymbolRegular.Settings24}"
                        PageTag="settings"
                        PageType="{x:Type pages:SettingsPage}" />
                    <custom:NavigationItem
                        Content="{x:Static resources:Resource.MainWindow_NavigationItem_Donate}"
                        Symbol="{x:Static wpfui:SymbolRegular.Heart24}"
                        PageTag="donate"
                        PageType="{x:Type pages:DonatePage}" />
                    <custom:NavigationItem
                        Content="{x:Static resources:Resource.MainWindow_NavigationItem_About}"
                        Symbol="{x:Static wpfui:SymbolRegular.Info24}"
                        PageTag="about"
                        PageType="{x:Type pages:AboutPage}" />
                </compat:NavigationStore.Footer>

            </compat:NavigationStore>

            <Border
                Grid.Column="1"
                Background="{DynamicResource ControlFillColorDefaultBrush}"
                CornerRadius="8,0,0,0">
                <Frame Name="_rootFrame" Margin="24,0,0,0" 
                       JournalOwnership="OwnsJournal" 
                       NavigationUIVisibility="Hidden" />
            </Border>

            <compat:Snackbar
                x:Name="_snackbar"
                Grid.Column="1"
                MinWidth="340"
                MaxWidth="450"
                HorizontalAlignment="Center"
                Visibility="Collapsed"
                Icon="{x:Static wpfui:SymbolRegular.Checkmark24}">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    
                    <!-- Icon container -->
                    <Border 
                        Grid.Column="0" 
                        Width="36" 
                        Height="36" 
                        Margin="4,4,12,4"
                        CornerRadius="8"
                        VerticalAlignment="Center"
                        Background="{DynamicResource AccentFillColorDefaultBrush}">
                        <wpfui:SymbolIcon 
                            x:Name="_snackbarIcon"
                            Symbol="Checkmark24" 
                            FontSize="18"
                            Foreground="White"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center" />
                    </Border>
                    
                    <StackPanel Grid.Column="1" Margin="0,4,8,4" VerticalAlignment="Center">
                        <!--  ReSharper disable once UnusedMember.Global  -->
                        <TextBlock
                            x:Name="_snackbarTitle"
                            VerticalAlignment="Center"
                            FontSize="14"
                            FontWeight="SemiBold"
                            Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                            TextWrapping="WrapWithOverflow" />
                        <!--  ReSharper disable once UnusedMember.Global  -->
                        <TextBlock
                            x:Name="_snackbarMessage"
                            Margin="0,2,0,0"
                            FontSize="12"
                            Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                            TextWrapping="WrapWithOverflow" />
                    </StackPanel>
                    
                    <compat:Button
                        Grid.Column="2"
                        Padding="6"
                        VerticalAlignment="Center"
                        Appearance="Transparent"
                        Icon="{x:Static wpfui:SymbolRegular.Dismiss24}"
                        Click="CloseSnackbar_Click" />
                </Grid>
            </compat:Snackbar>

        </Grid>

        <Border
            x:Name="_vantageIndicator"
            Grid.Row="2"
            Padding="8,4,8,6"
            Background="Orange"
            Visibility="Collapsed">
            <StackPanel HorizontalAlignment="Center" Orientation="Horizontal">
                <wpfui:SymbolIcon
                    Margin="0,0,4,0"
                    Foreground="Black"
                    Symbol="Warning24" />
                <TextBlock
                    Focusable="True"
                    Foreground="Black"
                    Text="{x:Static resources:Resource.MainWindows_VantageRunning}" />
            </StackPanel>
        </Border>

        <Border
            x:Name="_legionZoneIndicator"
            Grid.Row="3"
            Padding="8,4,8,6"
            Background="Orange"
            Visibility="Collapsed">
            <StackPanel HorizontalAlignment="Center" Orientation="Horizontal">
                <wpfui:SymbolIcon
                    Margin="0,0,4,0"
                    Foreground="Black"
                    Symbol="Warning24" />
                <TextBlock
                    Focusable="True"
                    Foreground="Black"
                    Text="{x:Static resources:Resource.MainWindow_LegionZoneRunning}" />
            </StackPanel>
        </Border>

        <Border
            x:Name="_fnKeysIndicator"
            Grid.Row="4"
            Padding="8,4,8,6"
            Background="Orange"
            Visibility="Collapsed">
            <StackPanel HorizontalAlignment="Center" Orientation="Horizontal">
                <wpfui:SymbolIcon
                    Margin="0,0,4,0"
                    Foreground="Black"
                    Symbol="Warning24" />
                <TextBlock
                    Focusable="True"
                    Foreground="Black"
                    Text="{x:Static resources:Resource.MainWindows_FnKeysRunning}" />
            </StackPanel>
        </Border>

        <Border
            x:Name="_updateIndicator"
            Grid.Row="5"
            Padding="8,4,8,6"
            Background="{DynamicResource SystemFillColorSuccessBrush}"
            Cursor="Hand"
            MouseLeftButtonDown="UpdateIndicator_Click"
            MouseRightButtonDown="UpdateIndicator_Click"
            Visibility="Collapsed">
            <StackPanel HorizontalAlignment="Center" Orientation="Horizontal">
                <wpfui:SymbolIcon Margin="0,0,4,0" Symbol="ArrowRepeatAll24" />
                <TextBlock
                    x:Name="_updateIndicatorText"
                    Focusable="True"
                    KeyDown="UpdateIndicator_KeyDown"
                    Text="{x:Static resources:Resource.MainWindow_UpdateAvailable}" />
            </StackPanel>
        </Border>

        <!-- Modern Dialog Host for Windows 11 style dialogs -->
        <ContentPresenter 
            x:Name="RootContentDialogPresenter" 
            Grid.RowSpan="6" 
            Panel.ZIndex="2000" />

    </Grid>
</local:BaseWindow>
