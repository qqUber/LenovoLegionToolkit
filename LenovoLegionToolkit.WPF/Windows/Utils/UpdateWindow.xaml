<local:BaseWindow
    x:Class="LenovoLegionToolkit.WPF.Windows.Utils.UpdateWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="clr-namespace:LenovoLegionToolkit.WPF.Windows"
    xmlns:md="http://schemas.lepo.co/wpfui/2022/xaml/markdown"
    xmlns:resources="clr-namespace:LenovoLegionToolkit.WPF.Resources"
    xmlns:utils="clr-namespace:LenovoLegionToolkit.WPF.Utils"
    xmlns:compat="clr-namespace:LenovoLegionToolkit.WPF.Compat"
    xmlns:wpfui="http://schemas.lepo.co/wpfui/2022/xaml"
    xmlns:ui="clr-namespace:Wpf.Ui.Controls;assembly=Wpf.Ui"
    Title="{x:Static resources:Resource.UpdateWindow_Title}"
    Width="900"
    Height="700"
    MinWidth="900"
    MinHeight="700"
    MaxWidth="900"
    MaxHeight="700"
    Closing="UpdateWindow_Closing"
    ExtendsContentIntoTitleBar="True"
    FlowDirection="{x:Static utils:LocalizationHelper.Direction}"
    Loaded="UpdateWindow_Loaded"
    ResizeMode="NoResize"
    ShowInTaskbar="False"
    WindowStartupLocation="CenterOwner"
    Background="{DynamicResource ApplicationBackgroundBrush}">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <compat:TitleBar
            Grid.Row="0"
            CanMaximize="false"
            ShowMaximize="false"
            ShowMinimize="false"
            UseSnapLayout="false" />

        <!-- Modern Gradient Header -->
        <Grid Grid.Row="0" Height="180" Background="{DynamicResource ControlFillColorDefaultBrush}">
            <Grid.RowDefinitions>
                <RowDefinition Height="32" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>
            
            <!-- Title Bar Area -->
            <Grid Grid.Row="0" Margin="12,8,12,0">
                <TextBlock
                    VerticalAlignment="Center"
                    Focusable="True"
                    FontSize="12"
                    IsHitTestVisible="False"
                    Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                    Text="{x:Static resources:Resource.UpdateWindow_Title}" />
            </Grid>

            <!-- Hero Content -->
            <Grid Grid.Row="1" Margin="32,16,32,24">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" VerticalAlignment="Center">
                    <!-- Icon + Title -->
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                        <Border
                            Width="56"
                            Height="56"
                            CornerRadius="16"
                            Background="{DynamicResource AccentFillColorDefaultBrush}"
                            Margin="0,0,16,0">
                            <wpfui:SymbolIcon
                                Symbol="ArrowCircleDown24"
                                FontSize="32"
                                Foreground="White" />
                        </Border>
                        
                        <StackPanel VerticalAlignment="Center">
                            <TextBlock
                                FontSize="28"
                                FontWeight="SemiBold"
                                Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                                Text="{x:Static resources:Resource.UpdateWindow_Title}" />
                            <TextBlock
                                x:Name="_updateInfoText"
                                FontSize="14"
                                Margin="0,4,0,0"
                                Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                                Text="A new version is available!" />
                        </StackPanel>
                    </StackPanel>
                </StackPanel>

                <!-- Version Badge -->
                <Border
                    Grid.Column="1"
                    x:Name="_versionBadge"
                    VerticalAlignment="Center"
                    Padding="20,12"
                    CornerRadius="20"
                    Background="{DynamicResource AccentFillColorSecondaryBrush}">
                    <StackPanel>
                        <TextBlock
                            FontSize="12"
                            FontWeight="Medium"
                            HorizontalAlignment="Center"
                            Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                            Text="Latest Version" />
                        <TextBlock
                            x:Name="_versionText"
                            FontSize="24"
                            FontWeight="Bold"
                            HorizontalAlignment="Center"
                            Margin="0,4,0,0"
                            Foreground="{DynamicResource AccentTextFillColorPrimaryBrush}"
                            Text="v0.0.0" />
                    </StackPanel>
                </Border>
            </Grid>
        </Grid>

        <!-- Content Area -->

        <!-- Content Area -->
        <Grid Grid.Row="1" Margin="32,24,32,32">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!-- What's New Section Header -->
            <Border Grid.Row="0" Margin="0,0,0,16">
                <StackPanel Orientation="Horizontal">
                    <wpfui:SymbolIcon
                        Symbol="Sparkle24"
                        FontSize="20"
                        Margin="0,0,8,0"
                        Foreground="{DynamicResource AccentTextFillColorPrimaryBrush}" />
                    <TextBlock
                        FontSize="20"
                        FontWeight="SemiBold"
                        VerticalAlignment="Center"
                        Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                        Text="{x:Static resources:Resource.UpdateWindow_WhatsNew}" />
                </StackPanel>
            </Border>

            <!-- Changelog with Custom Styling -->
            <Border
                Grid.Row="1"
                Background="{DynamicResource ControlFillColorDefaultBrush}"
                BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
                BorderThickness="1"
                CornerRadius="8"
                Padding="20">
                <md:MarkdownViewer
                    x:Name="_markdownViewer"
                    Focusable="True" />
            </Border>

            <!-- Progress Section -->
            <Border
                Grid.Row="2"
                x:Name="_progressSection"
                Margin="0,20,0,0"
                Padding="20,16"
                Background="{DynamicResource ControlFillColorSecondaryBrush}"
                BorderBrush="{DynamicResource AccentFillColorDefaultBrush}"
                BorderThickness="1"
                CornerRadius="8"
                Visibility="Collapsed">
                <StackPanel>
                    <Grid Margin="0,0,0,12">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        
                        <StackPanel Grid.Column="0" Orientation="Horizontal">
                            <wpfui:SymbolIcon
                                Symbol="ArrowDownload24"
                                FontSize="18"
                                Margin="0,0,8,0"
                                Foreground="{DynamicResource AccentTextFillColorPrimaryBrush}" />
                            <TextBlock
                                x:Name="_downloadStatusText"
                                VerticalAlignment="Center"
                                FontSize="14"
                                FontWeight="Medium"
                                Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                                Text="Downloading update..." />
                        </StackPanel>
                        
                        <TextBlock
                            x:Name="_downloadPercentText"
                            Grid.Column="1"
                            VerticalAlignment="Center"
                            FontSize="14"
                            FontWeight="SemiBold"
                            Foreground="{DynamicResource AccentTextFillColorPrimaryBrush}"
                            Text="0%" />
                    </Grid>
                    
                    <ProgressBar
                        x:Name="_downloadProgressBar"
                        Height="10"
                        IsIndeterminate="True"
                        Maximum="1"
                        Minimum="0" />
                </StackPanel>
            </Border>

            <!-- Action Buttons -->
            <Grid Grid.Row="3" Margin="0,24,0,0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <!-- Primary Action -->
                <Grid Grid.Row="0" HorizontalAlignment="Stretch">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="8" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <wpfui:Button
                        x:Name="_downloadButton"
                        Grid.Column="0"
                        Height="48"
                        Appearance="Primary"
                        Click="DownloadButton_Click"
                        Content="Download &amp; Install"
                        FontSize="14"
                        FontWeight="SemiBold"
                        Icon="{x:Static ui:SymbolRegular.ArrowCircleDown24}"
                        IsEnabled="False"
                        ToolTip="Download and install the update now" />

                    <wpfui:Button
                        x:Name="_cancelDownloadButton"
                        Grid.Column="0"
                        Height="48"
                        Appearance="Danger"
                        Click="CancelDownloadButton_Click"
                        Content="{x:Static resources:Resource.Cancel}"
                        FontSize="14"
                        FontWeight="SemiBold"
                        Icon="{x:Static ui:SymbolRegular.DismissCircle24}"
                        IsEnabled="False"
                        Visibility="Collapsed" />

                    <wpfui:Button
                        x:Name="_remindLaterButton"
                        Grid.Column="2"
                        Height="48"
                        Click="RemindLaterButton_Click"
                        Content="Remind Me Later"
                        FontSize="14"
                        Icon="{x:Static ui:SymbolRegular.Clock24}"
                        ToolTip="Close and remind me in 24 hours" />
                </Grid>

                <!-- Secondary Actions -->
                <Grid Grid.Row="1" Margin="0,12,0,0" HorizontalAlignment="Center">
                    <wpfui:Button
                        x:Name="_skipVersionButton"
                        Height="36"
                        Appearance="Transparent"
                        Click="SkipVersionButton_Click"
                        Content="Skip This Version"
                        FontSize="13"
                        Icon="{x:Static ui:SymbolRegular.Dismiss24}"
                        ToolTip="Don't show this update again" />
                </Grid>
            </Grid>
        </Grid>
    </Grid>
</local:BaseWindow>

